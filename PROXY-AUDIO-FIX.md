# üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ–∫—Å–∏-—ç–Ω–¥–ø–æ–∏–Ω—Ç–∞ –¥–ª—è –∞—É–¥–∏–æ

## –ü—Ä–æ–±–ª–µ–º—ã, –∫–æ—Ç–æ—Ä—ã–µ –±—ã–ª–∏ –æ–±–Ω–∞—Ä—É–∂–µ–Ω—ã –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã:

### 1. **–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ—Ç–æ–∫–∞ –¥–∞–Ω–Ω—ã—Ö (Stream)**
**–ü—Ä–æ–±–ª–µ–º–∞:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è —É—Å—Ç–∞—Ä–µ–≤—à–∏–π API `ReadableStream.getReader()` –¥–ª—è Fetch API, —á—Ç–æ –≤—ã–∑—ã–≤–∞–ª–æ –Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å –ø—Ä–∏ –ø–æ—Ç–æ–∫–æ–≤–æ–π –ø–µ—Ä–µ–¥–∞—á–µ –∞—É–¥–∏–æ —á–µ—Ä–µ–∑ serverless —Ñ—É–Ω–∫—Ü–∏—é.

**–†–µ—à–µ–Ω–∏–µ:** –ó–∞–º–µ–Ω–∏–ª–∏ –Ω–∞ `.pipe()` - –±–æ–ª–µ–µ –Ω–∞–¥–µ–∂–Ω—ã–π –∏ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –º–µ—Ç–æ–¥ Node.js –¥–ª—è –ø–æ—Ç–æ–∫–æ–≤–æ–π –ø–µ—Ä–µ–¥–∞—á–∏:
```javascript
// –î–û (–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ):
const reader = response.body.getReader();
while (true) {
  const { done, value } = await reader.read();
  if (done) break;
  res.write(Buffer.from(value));
}

// –ü–û–°–õ–ï (–ø—Ä–∞–≤–∏–ª—å–Ω–æ):
if (response.body && typeof response.body.pipe === 'function') {
  response.body.pipe(res);
}
```

### 2. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ CORS preflight –∑–∞–ø—Ä–æ—Å–æ–≤ (OPTIONS)**
**–ü—Ä–æ–±–ª–µ–º–∞:** –ë—Ä–∞—É–∑–µ—Ä –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç OPTIONS –∑–∞–ø—Ä–æ—Å –ø–µ—Ä–µ–¥ GET –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ CORS –ø–æ–ª–∏—Ç–∏–∫–∏, –Ω–æ –ø—Ä–æ–∫—Å–∏ –µ–≥–æ –Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–ª.

**–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–ª–µ–Ω–∞ —è–≤–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ OPTIONS –∑–∞–ø—Ä–æ—Å–æ–≤:
```javascript
if (req.method === 'OPTIONS') {
  res.setHeader('Access-Control-Allow-Origin', '*');
  res.setHeader('Access-Control-Allow-Methods', 'GET, HEAD, OPTIONS');
  res.setHeader('Access-Control-Allow-Headers', 'Content-Type, Range');
  res.status(200).end();
  return;
}
```

### 3. **–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω—ã–µ CORS –∑–∞–≥–æ–ª–æ–≤–∫–∏ –≤ –æ—Ç–≤–µ—Ç–µ**
**–ü—Ä–æ–±–ª–µ–º–∞:** –ë—Ä–∞—É–∑–µ—Ä –±–ª–æ–∫–∏—Ä–æ–≤–∞–ª –æ—Ç–≤–µ—Ç –∏–∑-–∑–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã—Ö CORS –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤.

**–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–ª–µ–Ω—ã –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ CORS –∑–∞–≥–æ–ª–æ–≤–∫–∏ –≤ –∫–æ–Ω–µ—á–Ω—ã–π –æ—Ç–≤–µ—Ç:
```javascript
res.setHeader('Access-Control-Allow-Origin', '*');
res.setHeader('Access-Control-Allow-Methods', 'GET, HEAD, OPTIONS');
res.setHeader('Access-Control-Allow-Headers', 'Content-Type, Range');
```

### 4. **Accept-Encoding –∏ –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∞—É–¥–∏–æ**
**–ü—Ä–æ–±–ª–µ–º–∞:** –ù–µ —É–∫–∞–∑—ã–≤–∞–ª–æ—Å—å —è–≤–Ω–æ, —á—Ç–æ –º—ã –ø—Ä–∏–Ω–∏–º–∞–µ–º –∞—É–¥–∏–æ –∫–æ–Ω—Ç–µ–Ω—Ç, –∏ –Ω–µ –±—ã–ª–æ —è–≤–Ω–æ–≥–æ –∑–∞–ø—Ä–µ—Ç–∞ –Ω–∞ —Å–∂–∞—Ç–∏–µ.

**–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–ª–µ–Ω—ã –∑–∞–≥–æ–ª–æ–≤–∫–∏:
```javascript
const fetchHeaders = {
  'Accept': 'audio/*',
  'Accept-Encoding': 'identity'  // –∑–∞–ø—Ä–µ—â–∞–µ–º —Å–∂–∞—Ç–∏–µ –¥–ª—è –∞—É–¥–∏–æ
};
```

## –ö–∞–∫ —ç—Ç–æ –≤–ª–∏—è–µ—Ç –Ω–∞ –∑–∞–≥—Ä—É–∑–∫—É –∞—É–¥–∏–æ:

1. **–†–∞–Ω—å—à–µ:** –ë—Ä–∞—É–∑–µ—Ä ‚Üí OPTIONS preflight ‚Üí 405 –æ—à–∏–±–∫–∞ –∏–ª–∏ –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω–æ–µ –º–æ–ª—á–∞–Ω–∏–µ ‚Üí GET –∑–∞–ø—Ä–æ—Å ‚Üí –ø–æ—Ç–æ–∫–æ–≤–∞—è –æ—à–∏–±–∫–∞ ‚Üí –∑–≤—É–∫–∞ –Ω–µ—Ç

2. **–¢–µ–ø–µ—Ä—å:** 
   - –ë—Ä–∞—É–∑–µ—Ä ‚Üí OPTIONS ‚Üí 200 OK —Å CORS –∑–∞–≥–æ–ª–æ–≤–∫–∞–º–∏
   - –ë—Ä–∞—É–∑–µ—Ä ‚Üí GET ‚Üí 200 OK —Å –ø–æ—Ç–æ–∫–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ —á–µ—Ä–µ–∑ `.pipe()`
   - Audio —ç–ª–µ–º–µ–Ω—Ç –ø–æ–ª—É—á–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ ‚Üí ‚úÖ –ó–≤—É–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ñ–∞–π–ª `test-proxy.js` –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:
```bash
node test-proxy.js
```

–ó–∞—Ç–µ–º –æ—Ç–∫—Ä–æ–π—Ç–µ –±—Ä–∞—É–∑–µ—Ä –∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:
- –ï—Å–ª–∏ –ø—Ä–æ–∫—Å–∏ —Ä–∞–±–æ—Ç–∞–µ—Ç, –æ—Ç–∫—Ä–æ–µ—Ç—Å—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –∞—É–¥–∏–æ—Ñ–∞–π–ª–∞
- –í DevTools ‚Üí Network –º–æ–∂–Ω–æ —É–≤–∏–¥–µ—Ç—å –∑–∞–ø—Ä–æ—Å—ã —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –∑–∞–≥–æ–ª–æ–≤–∫–∞–º–∏

## –ö–ª—é—á–µ–≤—ã–µ —Ñ–∞–π–ª—ã:
- ‚úÖ `/api/proxy-audio.js` - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π –ø—Ä–æ–∫—Å–∏
- ‚úÖ `/src/lib/storageRouter.js` - –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è URL (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø—Ä–æ–∫—Å–∏ –¥–ª—è Hostinger)
- ‚úÖ `/src/hooks/player_page/useEpisodeData.js` - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç getCorrectAudioUrl –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –∞—É–¥–∏–æ

## –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ:

–ï—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è Vercel/Netlify, —É–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ:
1. –§—É–Ω–∫—Ü–∏—è –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ `/api/proxy-audio.js` (–∏–ª–∏ –≤ –ø–∞–ø–∫–µ `api/` –¥–ª—è Vercel)
2. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è Node.js 18+ (–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç fetch API)
3. –¢–∞–π–º–∞—É—Ç —Ñ—É–Ω–∫—Ü–∏–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –º–∏–Ω–∏–º—É–º –Ω–∞ 60 —Å–µ–∫—É–Ω–¥ (–¥–ª—è –ø–æ—Ç–æ–∫–æ–≤–æ–π –ø–µ—Ä–µ–¥–∞—á–∏)
