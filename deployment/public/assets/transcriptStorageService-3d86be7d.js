import{l as e,_ as r,c as s}from"./index-13791832.js";let t=null;const a=async(r,a,n,o="unknown")=>{const i=`${r}_${a.toUpperCase()}_${o}.json`,u=JSON.stringify(n,null,2);e.info(`Uploading transcript to Supabase Storage: ${i}`);try{const n=(()=>{if(t)return t;if("undefined"!=typeof window)return e.warn("supabaseServerClient called in browser - using fallback"),t=s("https://supabase.dosmundos.pe","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJyb2xlIjoiYW5vbiIsImlzcyI6InN1cGFiYXNlLWRlbW8iLCJpYXQiOjE2NDE3NjkyMDAsImV4cCI6MTk5OTk5OTk5OX0.A4_N08ZorXYT17zhZReBXPlY6L5-9d8thMbm7TcDWl8"),t;const r={}.SUPABASE_URL||"https://supabase.dosmundos.pe",a={}.SUPABASE_SERVICE_ROLE_KEY||{}.SERVICE_ROLE_KEY;if(!a)throw new Error("Supabase service key not found. Please set SUPABASE_SERVICE_ROLE_KEY or SERVICE_ROLE_KEY in .env");return t=s(r,a,{auth:{autoRefreshToken:!1,persistSession:!1}}),t})(),o=Buffer.from(u,"utf8"),{data:c,error:p}=await n.storage.from("transcript").upload(i,o,{contentType:"application/json",upsert:!0});if(p)return e.error("Supabase upload error:",p),{success:!1,error:p.message};e.info("Upload successful:",c);const{data:l}=n.storage.from("transcript").getPublicUrl(i),d=l.publicUrl;e.info("Public URL:",d);const{error:f}=await n.from("transcripts").update({storage_url:d,updated_at:(new Date).toISOString()}).eq("episode_slug",r).eq("lang",a);return f?(e.error("Database update error:",f),{success:!0,url:d,warning:"DB update failed"}):(e.info("âœ… Transcript saved to Supabase Storage and DB updated"),{success:!0,url:d})}catch(c){return e.error("Supabase storage error:",c),{success:!1,error:c.message}}},n=async(s=1)=>{if("undefined"!=typeof window)return e.warn("cleanupTempFiles: Not supported in browser environment"),{success:!1,error:"Browser environment"};try{const a=await r((()=>import("./__vite-browser-external-afb87ea8.js")),[]),n=await r((()=>import("./__vite-browser-external-afb87ea8.js")),[]),o=n.default.join(process.cwd(),"temp");if(!(await a.promises.access(o).then((()=>!0)).catch((()=>!1))))return e.debug("Temp directory does not exist, nothing to clean up"),{success:!0,cleaned:0};const i=await a.promises.readdir(o),u=60*s*60*1e3,c=Date.now();let p=0;for(const r of i){const s=n.default.join(o,r),i=await a.promises.stat(s);if(c-i.mtime.getTime()>u)try{await a.promises.unlink(s),p++,e.debug("Cleaned up old temp file:",r)}catch(t){e.warn("Failed to clean up temp file:",r,t.message)}}return e.info(`Temp file cleanup completed: ${p} files removed`),{success:!0,cleaned:p}}catch(t){return e.error("Error during temp file cleanup:",t.message),{success:!1,error:t.message}}},o=(r=1)=>{if("undefined"!=typeof window)return void e.warn("scheduleTempCleanup: Not supported in browser");const s=60*r*60*1e3;e.info(`Scheduling temp file cleanup every ${r} hour(s)`),n(),setInterval((()=>{n()}),s)};export{n as cleanupTempFiles,a as saveFullTranscriptToStorage,o as scheduleTempCleanup};
